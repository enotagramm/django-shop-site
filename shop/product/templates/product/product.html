{% extends "product/base.html" %}
{% load static %}
{% block content %}
<div class="container">
    <div class="header-product">
        <h1>{{ product.name }}</h1>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="carousel-container">
                <!-- SLAIDER -->
                <div id="carouselExampleIndicators" class="carousel carousel-dark slide" data-bs-ride="true">
                  <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                  </div>
                  <div class="carousel-inner">
                    {% for photo_item in product.productimage_set.all %}
                    {% if photo_item.is_main %}
                    <div class="carousel-item active">
                      <img src="{{ photo_item.photo.url }}" class="d-block w-100" alt="">
                    </div>
                    {% elif photo_item.is_main == False %}
                    <div class="carousel-item">
                      <img src="{{ photo_item.photo.url }}" class="d-block w-100" alt="">
                    </div>
                    {% endif %}
                    {% endfor %}
                  </div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Предыдущий</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Следующий</span>
                  </button>
                </div> <!--slaider-->
            </div> <!--carusel-conteiner-->
        </div> <!--col-6-->

        <div class="col-6">
            <div class="carousel-container">

                <div class="card">
                    <div class="card-body">
                        <h1 class="card-title">{{ product.price }} ₽</h1>
                        <p class="card-text">
                            Цена товара не окончательная, просим Вас уточнять информацию в магазине.
                        </p>
                        <div class="text-center">
                            <a type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal"><h1>Купить</h1></a>
                        </div>
                    </div>
                </div>


                <!--tabs-->
                <div>
                    <nav>
                      <div class="nav nav-tabs product-description-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active nav-link-tabs" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">
                            Описание</button>
                        <button class="nav-link nav-link-tabs" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">
                            Доставка</button>
                        <button class="nav-link nav-link-tabs" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">
                            Отзывы</button>
                      </div>
                    </nav>
                    <div class="tab-content product-description-tabs" id="nav-tabContent">
                      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                          <p>{{ product.description | linebreaks }}</p>
                      </div>
                      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                          <h3>Как мы делаем доставку?</h3>
                      </div>
                      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab" tabindex="0">
                          <div class="header-review">
                              <h3>Оставить отзыв</h3>
                          </div>
                              <form action="{% url 'add_review' product.id %}" method="post" id="formReview">
                                {% csrf_token %}
                                  <input type="hidden" name="parent" id="contactparent" value="">
                                  <div class="mb-3">
                                    <label for="exampleFormControlTextarea1" class="form-label" >Ваш комментарий*</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="comment"></textarea>
                                  </div>
                                  <div class="mb-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="exampleInputEmail1" class="form-label">Адрес электронной почты*</label>
                                            <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Не забудь про почту" aria-describedby="emailHelp" name="email">
                                            <div id="emailHelp" class="form-text">Обещаем, всё останется между нами.</div>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label">Имя*</label>
                                            <input type="text" class="form-control" name="name">
                                        </div>
                                    </div>
                                  </div>
                                  <div class="d-grid gap-1">
                                  <button type="submit" class="btn btn-dark btn-review">Отправить</button>
                                  </div>
                              </form>
                      </div>
                    </div>
                </div> <!--tabs-->
            </div> <!--carusel-conteiner-->
        </div> <!--col-6-->

        <div class="carousel-container">
            <h2>Последние отзывы</h2>
                {% for r in product.get_review %}
                <div class="card mb-3 card-item col-md-6">
                  <div class="row g-2">
                    <div class="col-md-2">
                      <img src="{% static 'product/img/default_icon.jpg' %}" class="img-fluid rounded-start" alt="">
                    </div>
                    <div class="col-md-10">
                        <div class="card-header">
                            <p class="card-text"><small class="text-muted">Последнее обновление {{ r.time_create }}</small></p>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{ r.name }}</h5>
                            <p class="card-text">{{ r.comment }}</p>
                            <a href="#formReview" onclick="addReview('{{ r.name }}', '{{ r.id }}')" class="btn-custom">
                                Ответить
                            </a>
                        </div>
                    </div>
                  </div>

                  {% for rew in r.review_set.all %}
                  <div class="card mb-3 card-item col-md-12 parent-item">
                      <div class="row g-2">
                        <div class="col-md-2">
                          <img src="{% static 'product/img/default_icon.jpg' %}" class="img-fluid rounded-start" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="card-header">
                                <p class="card-text"><small class="text-muted">
                                    Последнее обновление {{ rew.time_create }}
                                </small></p>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">{{ rew.name }}</h5>
                                <p class="card-text">{{ rew.comment }}</p>
                            </div>
                        </div>
                      </div>
                  </div>
                  {% endfor %}
                </div>
                {% endfor %}

        </div>   <!--carusel-conteiner-->
    </div>  <!--row-->
</div>  <!--container-->
<script>
    function addReview(name, id) {
        document.getElementById("contactparent").value = id;
        document.getElementById("exampleFormControlTextarea1").innerText = `${name}, `
        }
</script>
{% endblock %}